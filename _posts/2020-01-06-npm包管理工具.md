---
layout: post
#标题配置
title:  1月学习计划之-node学习
#时间配置
date:   2020-01-06 14:33:00 +0800
#大类配置
categories: Node介绍与Node模块
#小类配置
tag: node.js
---

* content
{:toc}

介绍
======

由于不想再让js这么局限，只是在一个脚本程序阶段，期望他拥有像java、Python那样有开发大型应用的能力。

作为后端JavaScript的运行平台，Node保留了前端浏览器JavaScript中那些熟悉的接口，没有改写语言本身的任何特性，依旧基于作用域和原型链，区别在于它将前端中广泛运用的思想迁移到了服务器端。

通过将计算分发到各个子进程，可以将大量计算分解掉，然后再通过进程之间的事件消息来传递结果，这可以很好地保持应用模型的简单和低依赖。.Node通过将计算分发到各个子进程，可以将大量计算分解掉，然后再通过进程之间的事件消息来传递结果，这可以很好地保持应用模型的简单和低依赖。

模块
======
CommonJS
-----

JS的缺陷：
1、 没有模块系统
2、 标准库较少。（没有标准的I/O流API）
3、 没有标准接口。（对于数据库或web服务器没有统一标准接口）
4、 缺乏包管理系统。（无法自动加载和安装依赖）


![Node与浏览器以及W3C组织、CommonJS组织、ECMAScript之间的关系](https://cdn.weipaitang.com/static/20200106a5ee08f0-a3d9-08f0a3d9-6b6a-ce0e3f08d474-W1572H400)

CommonJS现在可以：
1、 服务器端JavaScript应用程序。
2、 命令行工具。
3、 桌面图形界面应用程序。
4、 混合应用（Titanium和Adobe AIR等形式的应用）。


模块的定义：
1、 模块引用
```js
var math = require('math');
```
2、 模块定义
```js
// math.js
exports.add = function () {
  var sum = 0,
    i = 0,
    args = arguments,
    l = args.length;
  while (i < l) {
    sum += args[i++];
  }
  return sum;
};

// program.js
var math = require('math');
exports.increment = function (val) {
  return math.add(val, 1);
};
```
3、 模块标识
![Node与浏览器以及W3C组织、CommonJS组织、ECMAScript之间的关系](https://cdn.weipaitang.com/static/20200106b31e588c-e941-588ce941-e38c-7dd10248023e-W1176H528)


Node模块加载过程
--------
Node的模块分有两类：核心模块和文件模块。

· 文件模块：

Node加载模块会经历3个历程：路径分析，文件定位，编译执行

1、 优先从缓存加载

需注意的是，核心模块的缓存检查优先于文件模块的缓存检查。

2、 路径分析和文件定位

模块标识符分析

核心模块：
```js
require(http);
require(fs);
require(path);
```
相对路径文件模块：
```js
require(./---);
require(../---);
```
绝对路径文件模块：
```js
require(/---);
```
自定义模块加载最慢，通过加载的路径分析，他会爬取当前目录、父目录、父目录的父目录、沿着路径进行递归，直到爬取到根目录的node_modules目录。

由于缓存加载的优化策略，使得二次引用的时候不必要路径分析，文件定位和编译执行的过程了。

3、 模块编译

对于node来讲，每个文件都是一个模块。等他定位到文件的位置后，根据路径载入编译。

结尾是.js文件以fs的方式载入。 通过module，exports，require。
每个js文件都会被包装成:
```js
(function (exports, require, module, __filename, __dirname) {
    js
});
```
.C/C++模块（.node）通过dlopen（）方式载入。 
.json通过fs读取后，用JSON.parse()解析。
其余的都以js文件的方式载入。

· 核心模块：
由C/C++编写。速度快，效率高。

![核心模块依赖关系](https://cdn.weipaitang.com/static/20200107fa0f08ac-b4a4-08acb4a4-b718-277c48b3b7b2-W1212H1368)

![os原生模块引入流程](https://cdn.weipaitang.com/static/2020010769f5b3ed-f592-b3edf592-9708-80225c0f0049-W1194H1546)



